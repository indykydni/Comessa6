@using Comessa6.ViewModels;
@model IEnumerable<OrderViewModel>
  <head>
      <link href="~/Content/index.css" rel="stylesheet">
  </head>
<body>
    <div id="orders-list-wrapper">
        <ul id="orders-list">
            @{string providerName = string.Empty; }
            @foreach (OrderViewModel order in Model)
            {
                bool isMine = string.Equals(order.UserID, Session["UserID"]);
                string itemClass = isMine ? "order-item driver" : "order-item passenger";
                
                if (!string.Equals(order.ProviderName, providerName))
                {
                    <li>
                        <div class="providerName"><span>@order.ProviderName</span></div>
                    </li>

                }
                <li class="@itemClass" id="@("header" + order.ID.ToString())">                        
                    <ul class="order-item-wrapper" id="@("order" + order.ID.ToString())">
                        <li class="order-item-content order-item-start">
                            <div class="item"><div class="autoFontSize">@order.ItemName</div></div>
                            <div class="comment"><span class="fonticon"></span>@order.Comment</div>
                            <div class="userName">@order.UserName</div>
                            @*<div class="provider"><span class="fonticon"></span>@order.ProviderName</div>*@
                        </li>
                        <li class="order-item-content order-item-date">
                            <span class="price">@order.Price</span>
                        </li> 
                        @if (order.Status == OrderStatus.Ordered && isMine)
                        {
                            <li>
                                <button class="order-item-button" orderID="@order.ID" onclick="DeleteClicked(this)">-</button>
                            </li>
                        }
                    </ul>  
                </li>
                providerName = order.ProviderName;
            }
        </ul>
    </div>
    <script>
        function DeleteClicked(button) {
            var orderID = button.getAttribute("orderID");
            $.ajax({
                url: '@Url.Action("DeleteOrder", "Orders")',
                type: 'POST',
                data: JSON.stringify({ "ID": orderID }),
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                success: function (result)
                {
                    var orderPanel = $("#header" + orderID);
                    if (orderPanel)
                        orderPanel.remove();
                    var orderPanel = $("#panel" + orderID);
                    if (orderPanel)
                        orderPanel.remove();
                },
                error: function (error) { alert("Database failure: " + error.statusText); }
            });
            return false;
        }
    </script>
</body>
